<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Bord - إدارة المتجر</title>
    <style>
        /* Variables CSS */
        :root {
            --primary-color: #0A2E68;
            --secondary-color: #1F4F9E;
            --accent-color: #2E6BFF;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --text-light: #FFFFFF;
            --text-dark: #333333;
            --bg-light: #F5F7FA;
            --sidebar-width: 250px;
            --header-height: 70px;
            --transition: all 0.3s ease;
            --border-radius: 10px;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 5px 20px rgba(0, 0, 0, 0.15);
        }

        /* Reset et styles de base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: var(--bg-light);
            overflow-x: hidden;
        }

        h1, h2, h3, h4, h5, h6 {
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 1rem;
        }

        p {
            margin-bottom: 1rem;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        ul {
            list-style: none;
        }

        img {
            max-width: 100%;
            height: auto;
            border-radius: var(--border-radius);
        }

        .container {
            padding: 20px;
        }

        /* Layout principal */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: var(--text-light);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: var(--transition);
            z-index: 1000;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 1rem;
        }

        .logo-img {
            height: 40px;
            width: 120px;
            object-fit: cover;
            border-radius: 5px;
            background-color: white;
            padding: 5px;
        }

        .logo-text {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .logo-text span {
            color: var(--accent-color);
        }

        .admin-info {
            text-align: center;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .admin-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-size: 1.5rem;
            font-weight: bold;
            border: 3px solid rgba(255, 255, 255, 0.2);
        }

        .admin-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .admin-role {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        .sidebar-menu {
            padding: 1.5rem 0;
        }

        .menu-item {
            padding: 0.8rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: var(--transition);
            border-left: 3px solid transparent;
            margin: 5px 0;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-left-color: var(--accent-color);
        }

        .menu-item.active {
            background-color: rgba(255, 255, 255, 0.15);
            border-left-color: var(--accent-color);
        }

        .menu-item i {
            width: 20px;
            font-size: 1.1rem;
        }

        .menu-text {
            font-weight: 500;
            font-size: 0.9rem;
        }

        /* Contenu principal */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 20px;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: var(--text-light);
            padding: 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .page-title i {
            color: var(--primary-color);
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .notification-badge {
            position: relative;
            cursor: pointer;
            padding: 10px;
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logout-btn {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
        }

        .logout-btn:hover {
            background-color: #c82333;
        }

        /* Cartes de statistiques */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--text-light);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-icon.orders {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
        }

        .stat-icon.revenue {
            background-color: rgba(32, 107, 255, 0.1);
            color: var(--accent-color);
        }

        .stat-icon.products {
            background-color: rgba(255, 193, 7, 0.1);
            color: var(--warning-color);
        }

        .stat-icon.customers {
            background-color: rgba(23, 162, 184, 0.1);
            color: var(--info-color);
        }

        .stat-info h3 {
            font-size: 2rem;
            margin-bottom: 0.2rem;
        }

        .stat-info p {
            color: #666;
            font-size: 0.9rem;
            margin: 0;
        }

        /* Sections de contenu */
        .content-section {
            background: var(--text-light);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 30px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--bg-light);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            padding: 8px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: var(--text-dark);
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }

        /* Tables */
        .table-responsive {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background-color: var(--bg-light);
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--text-dark);
            border-bottom: 2px solid #dee2e6;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
        }

        .data-table tr:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-pending {
            background-color: rgba(255, 193, 7, 0.1);
            color: var(--warning-color);
        }

        .status-processing {
            background-color: rgba(23, 162, 184, 0.1);
            color: var(--info-color);
        }

        .status-shipped {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
        }

        .status-delivered {
            background-color: rgba(32, 107, 255, 0.1);
            color: var(--accent-color);
        }

        .status-cancelled {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: var(--transition);
        }

        .action-btn.edit {
            background-color: rgba(32, 107, 255, 0.1);
            color: var(--accent-color);
        }

        .action-btn.delete {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
        }

        .action-btn.view {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
        }

        .action-btn.confirm {
            background-color: rgba(255, 193, 7, 0.1);
            color: var(--warning-color);
        }

        .action-btn:hover {
            opacity: 0.8;
        }

        /* Formulaires */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-dark);
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(32, 107, 255, 0.1);
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        /* Image uploader */
        .image-uploader {
            border: 2px dashed #ddd;
            border-radius: var(--border-radius);
            padding: 2rem;
            text-align: center;
            background-color: var(--bg-light);
            cursor: pointer;
            transition: var(--transition);
        }

        .image-uploader:hover {
            border-color: var(--accent-color);
            background-color: rgba(32, 107, 255, 0.05);
        }

        .image-uploader i {
            font-size: 3rem;
            color: #aaa;
            margin-bottom: 1rem;
        }

        .image-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .preview-item {
            position: relative;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .preview-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #dee2e6;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        /* Order Details Page */
        .order-details-page {
            display: none;
            background: var(--text-light);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 2rem;
            margin-bottom: 30px;
        }

        .order-details-page.active {
            display: block;
        }

        .back-to-orders {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 2rem;
            cursor: pointer;
            transition: var(--transition);
            padding: 8px 15px;
            background: var(--bg-light);
            border-radius: 5px;
        }

        .back-to-orders:hover {
            color: var(--accent-color);
            background: #e8f0ff;
        }

        .order-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 2rem;
        }

        .order-info-card {
            background: var(--bg-light);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--accent-color);
        }

        .order-info-card h3 {
            margin-bottom: 1rem;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .order-info-item {
            margin-bottom: 0.8rem;
            display: flex;
            justify-content: space-between;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .order-info-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }

        .order-info-label {
            font-weight: 500;
            color: #666;
        }

        .order-info-value {
            font-weight: 600;
            color: var(--text-dark);
        }

        .order-items {
            margin: 2rem 0;
        }

        .order-item {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid #eee;
            align-items: center;
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .order-item-img {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            background: var(--bg-light);
        }

        .order-item-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .order-item-details {
            flex: 1;
        }

        .order-item-details h4 {
            margin-bottom: 0.5rem;
        }

        .order-item-price {
            color: var(--accent-color);
            font-weight: 600;
        }

        .order-totals {
            background: var(--bg-light);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-top: 2rem;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #ddd;
        }

        .total-row:last-child {
            border-bottom: none;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .order-actions-container {
            display: flex;
            gap: 10px;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        /* Social Media Icons */
        .social-icons-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }

        .social-icon-item {
            flex: 1;
            min-width: 200px;
        }

        .social-icon-preview {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--bg-light);
            border-radius: 5px;
            margin-top: 10px;
        }

        .social-icon-preview i {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            color: white;
        }

        .whatsapp-icon {
            background-color: #25D366;
        }

        .messenger-icon {
            background-color: #0084FF;
        }

        .facebook-icon {
            background-color: #1877F2;
        }

        .instagram-icon {
            background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D);
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            background-color: var(--success-color);
            color: white;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: var(--transition);
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification.error {
            background-color: var(--danger-color);
        }

        .notification.warning {
            background-color: var(--warning-color);
            color: var(--text-dark);
        }

        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
                overflow: hidden;
            }

            .sidebar:hover {
                width: var(--sidebar-width);
            }

            .sidebar-header,
            .admin-info,
            .menu-text {
                display: none;
            }

            .sidebar:hover .sidebar-header,
            .sidebar:hover .admin-info,
            .sidebar:hover .menu-text {
                display: block;
            }

            .main-content {
                margin-left: 70px;
            }

            .menu-item {
                justify-content: center;
            }

            .sidebar:hover .menu-item {
                justify-content: flex-start;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 15px;
            }

            .header-actions {
                width: 100%;
                justify-content: space-between;
            }

            .section-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .order-info-grid {
                grid-template-columns: 1fr;
            }

            .order-item {
                flex-direction: column;
                text-align: center;
            }

            .order-item-img {
                width: 120px;
                height: 120px;
            }

            .order-actions-container {
                flex-direction: column;
            }

            .modal-content {
                width: 95%;
            }
        }

        @media (max-width: 576px) {
            .main-content {
                padding: 10px;
                margin-left: 70px;
            }

            .container {
                padding: 10px;
            }

            .section-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .action-buttons {
                flex-direction: column;
                gap: 5px;
            }

            .order-details-page {
                padding: 1rem;
            }

            .order-info-card {
                padding: 1rem;
            }
        }

        @media (max-width: 480px) {
            .sidebar {
                width: 0;
            }

            .sidebar.active {
                width: 100%;
            }

            .main-content {
                margin-left: 0;
            }

            .menu-toggle {
                display: block;
                position: fixed;
                top: 15px;
                left: 15px;
                z-index: 1002;
                background: var(--primary-color);
                color: white;
                border: none;
                border-radius: 5px;
                padding: 10px;
                cursor: pointer;
            }

            .sidebar .close-menu {
                display: block;
                position: absolute;
                top: 15px;
                right: 15px;
                background: none;
                border: none;
                color: white;
                font-size: 1.5rem;
                cursor: pointer;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
</head>
<body>
    <!-- Menu Toggle for Mobile -->
    <button class="menu-toggle" id="menuToggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Notification Toast -->
    <div class="notification" id="notification"></div>

    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-img" id="storeLogo"></div>
                    <div class="logo-text">Admin<span>Panel</span></div>
                </div>
            </div>

            <button class="close-menu" id="closeMenu" style="display: none;">
                <i class="fas fa-times"></i>
            </button>

            <div class="admin-info">
                <div class="admin-avatar" id="adminAvatar">A</div>
                <div class="admin-name" id="adminName">Administrateur</div>
                <div class="admin-role">Super Admin</div>
            </div>

            <div class="sidebar-menu">
                <div class="menu-item active" data-section="dashboard">
                    <i class="fas fa-home"></i>
                    <span class="menu-text">Tableau de bord</span>
                </div>
                
                <div class="menu-item" data-section="products">
                    <i class="fas fa-box"></i>
                    <span class="menu-text">Produits</span>
                </div>
                
                <div class="menu-item" data-section="orders">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="menu-text">Commandes</span>
                </div>
                
                <div class="menu-item" data-section="customers">
                    <i class="fas fa-users"></i>
                    <span class="menu-text">Clients</span>
                </div>
                
                <div class="menu-item" data-section="content">
                    <i class="fas fa-edit"></i>
                    <span class="menu-text">Contenu du site</span>
                </div>
                
                <div class="menu-item" data-section="social">
                    <i class="fas fa-share-alt"></i>
                    <span class="menu-text">Réseaux sociaux</span>
                </div>
                
                <div class="menu-item" data-section="orderSettings">
                    <i class="fas fa-cart-plus"></i>
                    <span class="menu-text">Paramètres commande</span>
                </div>
                
                <div class="menu-item" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span class="menu-text">Paramètres généraux</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="page-title">
                    <i class="fas fa-chart-line"></i>
                    <h1 id="pageTitle">Tableau de bord</h1>
                </div>
                
                <div class="header-actions">
                    <div class="notification-badge" id="notificationBtn">
                        <i class="fas fa-bell"></i>
                        <span class="badge" id="notificationCount">0</span>
                    </div>
                    
                    <button class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                        Déconnexion
                    </button>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div class="content-section" id="dashboardSection">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon orders">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalOrders">0</h3>
                            <p>Commandes</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon revenue">
                            <i class="fas fa-euro-sign"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalRevenue">0 €</h3>
                            <p>Revenu total</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon products">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalProducts">0</h3>
                            <p>Produits</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon customers">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalCustomers">0</h3>
                            <p>Clients</p>
                        </div>
                    </div>
                </div>

                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-history"></i>
                        <h2>Commandes récentes</h2>
                    </div>
                    <a href="#orders" class="btn btn-primary" onclick="showSection('orders')">
                        <i class="fas fa-eye"></i>
                        Voir toutes
                    </a>
                </div>

                <div class="table-responsive">
                    <table class="data-table" id="recentOrdersTable">
                        <thead>
                            <tr>
                                <th>N° Commande</th>
                                <th>Client</th>
                                <th>Date</th>
                                <th>Montant</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Les commandes seront chargées ici -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Products Section -->
            <div class="content-section" id="productsSection" style="display: none;">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-box"></i>
                        <h2>Gestion des produits</h2>
                    </div>
                    <button class="btn btn-primary" onclick="openProductModal()">
                        <i class="fas fa-plus"></i>
                        Nouveau produit
                    </button>
                </div>

                <div class="table-responsive">
                    <table class="data-table" id="productsTable">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Nom</th>
                                <th>Catégorie</th>
                                <th>Prix</th>
                                <th>Stock</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Les produits seront chargés ici -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Orders Section -->
            <div class="content-section" id="ordersSection" style="display: none;">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-shopping-cart"></i>
                        <h2>Gestion des commandes</h2>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="data-table" id="ordersTable">
                        <thead>
                            <tr>
                                <th>N° Commande</th>
                                <th>Client</th>
                                <th>Date</th>
                                <th>Produits</th>
                                <th>Montant</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Les commandes seront chargées ici -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Order Details Page -->
            <div class="order-details-page" id="orderDetailsPage">
                <!-- Le contenu des détails de la commande sera chargé ici -->
            </div>

            <!-- Content Management Section -->
            <div class="content-section" id="contentSection" style="display: none;">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-edit"></i>
                        <h2>Contenu du site web</h2>
                    </div>
                </div>

                <form id="contentForm">
                    <div class="form-group">
                        <label class="form-label">Nom du site</label>
                        <input type="text" class="form-control" id="siteName" placeholder="Entrez le nom de votre site">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Logo du site (URL)</label>
                        <input type="text" class="form-control" id="siteLogo" placeholder="https://example.com/logo.png">
                        <small>Entrez l'URL de votre logo</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Image de fond hero (URL)</label>
                        <input type="text" class="form-control" id="heroImage" placeholder="https://example.com/hero.jpg">
                        <small>Laisser vide pour un fond de couleur simple</small>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Titre principal</label>
                            <input type="text" class="form-control" id="mainTitle" placeholder="Titre principal du site">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Sous-titre</label>
                            <input type="text" class="form-control" id="subTitle" placeholder="Sous-titre descriptif">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Description du site</label>
                        <textarea class="form-control" id="siteDescription" rows="4" placeholder="Description complète du site"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Titre des produits</label>
                        <input type="text" class="form-control" id="productsTitle" placeholder="Titre de la section produits">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Description des produits</label>
                        <textarea class="form-control" id="productsDescription" rows="3" placeholder="Description de la section produits"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Titre des services</label>
                        <input type="text" class="form-control" id="servicesTitle" placeholder="Titre de la section services">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Services (un par ligne)</label>
                        <textarea class="form-control" id="servicesList" rows="6" placeholder="Service 1
Service 2
Service 3"></textarea>
                        <small>Entrez un service par ligne</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Images de produits par défaut (URLs, une par ligne)</label>
                        <textarea class="form-control" id="defaultImages" rows="4" placeholder="https://example.com/image1.jpg
https://example.com/image2.jpg"></textarea>
                        <small>Utilisées quand une image de produit n'est pas disponible</small>
                    </div>

                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i>
                        Enregistrer les modifications
                    </button>
                </form>
            </div>

            <!-- Social Media Section -->
            <div class="content-section" id="socialSection" style="display: none;">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-share-alt"></i>
                        <h2>Réseaux sociaux</h2>
                    </div>
                </div>

                <form id="socialForm">
                    <div class="social-icons-container">
                        <div class="social-icon-item">
                            <label class="form-label">WhatsApp</label>
                            <input type="text" class="form-control" id="whatsappUrl" placeholder="https://wa.me/212612345678">
                            <small>Lien WhatsApp avec le numéro international</small>
                            <div class="social-icon-preview">
                                <i class="fab fa-whatsapp whatsapp-icon"></i>
                                <span>WhatsApp</span>
                            </div>
                        </div>

                        <div class="social-icon-item">
                            <label class="form-label">Messenger</label>
                            <input type="text" class="form-control" id="messengerUrl" placeholder="https://m.me/votre.page">
                            <div class="social-icon-preview">
                                <i class="fab fa-facebook-messenger messenger-icon"></i>
                                <span>Messenger</span>
                            </div>
                        </div>

                        <div class="social-icon-item">
                            <label class="form-label">Facebook</label>
                            <input type="text" class="form-control" id="facebookUrl" placeholder="https://facebook.com/votre.page">
                            <div class="social-icon-preview">
                                <i class="fab fa-facebook facebook-icon"></i>
                                <span>Facebook</span>
                            </div>
                        </div>

                        <div class="social-icon-item">
                            <label class="form-label">Instagram</label>
                            <input type="text" class="form-control" id="instagramUrl" placeholder="https://instagram.com/votre.compte">
                            <div class="social-icon-preview">
                                <i class="fab fa-instagram instagram-icon"></i>
                                <span>Instagram</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <label class="form-label">Position des icônes</label>
                        <select class="form-control" id="socialPosition">
                            <option value="bottom-left">En bas à gauche</option>
                            <option value="bottom-right">En bas à droite</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i>
                        Enregistrer les paramètres
                    </button>
                </form>
            </div>

            <!-- Order Settings Section -->
            <div class="content-section" id="orderSettingsSection" style="display: none;">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-cart-plus"></i>
                        <h2>Paramètres de commande</h2>
                    </div>
                </div>

                <form id="orderSettingsForm">
                    <div class="form-group">
                        <h3 style="margin-bottom: 1rem; color: var(--text-dark);">Méthodes de commande activées</h3>
                        <div style="display: flex; flex-direction: column; gap: 15px;">
                            <label class="form-label" style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="whatsappEnabled" style="width: 20px; height: 20px;">
                                Commander via WhatsApp
                            </label>
                            
                            <label class="form-label" style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="messengerEnabled" style="width: 20px; height: 20px;">
                                Commander via Messenger
                            </label>
                            
                            <label class="form-label" style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="directOrderEnabled" style="width: 20px; height: 20px;">
                                Commande directe (enregistrée dans le système)
                            </label>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Numéro WhatsApp (avec code pays)</label>
                            <input type="text" class="form-control" id="whatsappNumber" placeholder="212612345678">
                            <small>Exemple: 212612345678 (Maroc)</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Lien Messenger</label>
                            <input type="text" class="form-control" id="messengerLink" placeholder="https://m.me/votre.page">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Message par défaut pour les commandes</label>
                        <textarea class="form-control" id="defaultOrderMessage" rows="4" placeholder="Message qui sera envoyé avec chaque commande..."></textarea>
                    </div>

                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i>
                        Enregistrer les paramètres
                    </button>
                </form>
            </div>

            <!-- Settings Section -->
            <div class="content-section" id="settingsSection" style="display: none;">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-cog"></i>
                        <h2>Paramètres généraux</h2>
                    </div>
                </div>

                <form id="settingsForm">
                    <div class="form-group">
                        <label class="form-label">Devise</label>
                        <input type="text" class="form-control" id="currency" value="€" placeholder="€, $, MAD, etc.">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Langue par défaut</label>
                        <select class="form-control" id="language">
                            <option value="fr">Français</option>
                            <option value="ar">العربية</option>
                            <option value="en">English</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Frais de livraison</label>
                        <input type="number" class="form-control" id="shippingCost" value="15" step="0.01">
                    </div>

                    <div class="form-group">
                        <label class="form-label">TVA (%)</label>
                        <input type="number" class="form-control" id="taxRate" value="20" step="0.1">
                    </div>

                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i>
                        Enregistrer les paramètres
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Nouveau produit</h3>
                <button class="close-modal" onclick="closeProductModal()">×</button>
            </div>
            <div class="modal-body">
                <form id="productForm">
                    <input type="hidden" id="productId">
                    
                    <div class="form-group">
                        <label class="form-label">Nom du produit *</label>
                        <input type="text" class="form-control" id="productName" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Catégorie *</label>
                            <select class="form-control" id="productCategory" required>
                                <option value="">Sélectionnez une catégorie</option>
                                <option value="electronics">Électronique</option>
                                <option value="fashion">Mode</option>
                                <option value="home">Maison</option>
                                <option value="beauty">Beauté</option>
                                <option value="sports">Sports</option>
                                <option value="books">Livres</option>
                                <option value="other">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Marque</label>
                            <input type="text" class="form-control" id="productBrand">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Prix (€) *</label>
                            <input type="number" class="form-control" id="productPrice" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Prix avant réduction</label>
                            <input type="number" class="form-control" id="productOldPrice" step="0.01">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Quantité en stock *</label>
                            <input type="number" class="form-control" id="productStock" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Statut</label>
                            <select class="form-control" id="productStatus">
                                <option value="available">Disponible</option>
                                <option value="low">Stock limité</option>
                                <option value="out">Rupture</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Description *</label>
                        <textarea class="form-control" id="productDescription" rows="4" required></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Caractéristiques (une par ligne)</label>
                        <textarea class="form-control" id="productFeatures" rows="4" placeholder="Caractéristique 1
Caractéristique 2
Caractéristique 3"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">URLs des images (une par ligne) *</label>
                        <textarea class="form-control" id="productImages" rows="3" required placeholder="https://example.com/image1.jpg
https://example.com/image2.jpg"></textarea>
                        <small>Entrez au moins une URL d'image</small>
                    </div>

                    <div class="image-preview" id="imagePreview"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" onclick="closeProductModal()">Annuler</button>
                <button class="btn btn-success" onclick="saveProduct()">
                    <i class="fas fa-save"></i>
                    Enregistrer
                </button>
            </div>
        </div>
    </div>

    <!-- Order Status Modal -->
    <div class="modal" id="orderStatusModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Changer le statut de la commande</h3>
                <button class="close-modal" onclick="closeOrderStatusModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Statut</label>
                    <select class="form-control" id="orderStatusSelect">
                        <option value="pending">En attente</option>
                        <option value="processing">En traitement</option>
                        <option value="shipped">Expédiée</option>
                        <option value="delivered">Livrée</option>
                        <option value="cancelled">Annulée</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes (optionnel)</label>
                    <textarea class="form-control" id="orderStatusNotes" rows="3" placeholder="Ajoutez des notes sur le changement de statut..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger" onclick="closeOrderStatusModal()">Annuler</button>
                <button class="btn btn-success" onclick="saveOrderStatus()">
                    <i class="fas fa-save"></i>
                    Enregistrer
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration and Main Script -->
    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDcZcD5gGwI5JRcphJxrWTXEE_v2QaBT8Y",
            authDomain: "waeilstore1.firebaseapp.com",
            databaseURL: "https://waeilstore1-default-rtdb.firebaseio.com",
            projectId: "waeilstore1",
            storageBucket: "waeilstore1.firebasestorage.app",
            messagingSenderId: "205531361584",
            appId: "1:205531361584:web:0c8152e7ec31e653d158f5",
            measurementId: "G-T91695J9DT"
        };

        // Initialiser Firebase
        let app, database, auth;
        try {
            app = firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            auth = firebase.auth();
        } catch (error) {
            console.error("Erreur d'initialisation Firebase:", error);
        }

        // Variables globales
        let currentUser = null;
        let allProducts = [];
        let allOrders = [];
        let allCustomers = [];
        let storeSettings = {};
        let orderSettingsData = {};
        let currentOrderId = null;

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            setupEventListeners();
            loadStoreSettings();
            loadOrderSettings();
        });

        function initializeDashboard() {
            // تعيين مستخدم افتراضي بدون مصادقة
            currentUser = {
                displayName: "Administrateur",
                email: "admin@example.com"
            };
            
            document.getElementById('adminName').textContent = 'Administrateur';
            document.getElementById('adminAvatar').textContent = 'A';
            
            // تحميل البيانات مباشرة
            loadDashboardData();
            
            console.log("لوحة التحكم جاهزة للاستخدام");
        }

        function setupEventListeners() {
            // Menu mobile
            const menuToggle = document.getElementById('menuToggle');
            const sidebar = document.getElementById('sidebar');
            const closeMenu = document.getElementById('closeMenu');

            menuToggle.addEventListener('click', function() {
                sidebar.classList.toggle('active');
            });

            closeMenu.addEventListener('click', function() {
                sidebar.classList.remove('active');
            });

            // Navigation
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    showSection(section);
                    // Fermer le menu sur mobile
                    if (window.innerWidth <= 480) {
                        sidebar.classList.remove('active');
                    }
                });
            });

            // Déconnexion (تهيئة فقط)
            document.getElementById('logoutBtn').addEventListener('click', function() {
                if (confirm("هل تريد إعادة تحميل الصفحة؟")) {
                    location.reload();
                }
            });

            // Formulaires
            document.getElementById('contentForm')?.addEventListener('submit', saveContent);
            document.getElementById('socialForm')?.addEventListener('submit', saveSocialSettings);
            document.getElementById('orderSettingsForm')?.addEventListener('submit', saveOrderSettings);
            document.getElementById('settingsForm')?.addEventListener('submit', saveGeneralSettings);
            
            // إضافة حدث لزر الإشعارات
            document.getElementById('notificationBtn').addEventListener('click', function() {
                showNotification('لا توجد إشعارات جديدة', 'info');
            });

            // Fermer le menu en cliquant à l'extérieur
            document.addEventListener('click', function(event) {
                const sidebar = document.getElementById('sidebar');
                const menuToggle = document.getElementById('menuToggle');
                
                if (window.innerWidth <= 480 && 
                    sidebar.classList.contains('active') && 
                    !sidebar.contains(event.target) && 
                    !menuToggle.contains(event.target)) {
                    sidebar.classList.remove('active');
                }
            });
        }

        function showSection(section) {
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.style.display = 'none';
            });

            document.getElementById('orderDetailsPage').classList.remove('active');

            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });

            const sectionElement = document.getElementById(section + 'Section');
            if (sectionElement) {
                sectionElement.style.display = 'block';
            }
            
            const menuItem = document.querySelector(`.menu-item[data-section="${section}"]`);
            if (menuItem) {
                menuItem.classList.add('active');
            }

            const titles = {
                'dashboard': 'Tableau de bord',
                'products': 'Produits',
                'orders': 'Commandes',
                'customers': 'Clients',
                'content': 'Contenu du site',
                'social': 'Réseaux sociaux',
                'orderSettings': 'Paramètres commande',
                'settings': 'Paramètres généraux'
            };
            document.getElementById('pageTitle').textContent = titles[section] || 'Tableau de bord';

            if (section === 'products') {
                loadProducts();
            } else if (section === 'orders') {
                loadOrders();
            } else if (section === 'customers') {
                loadCustomers();
            } else if (section === 'content') {
                loadContent();
            } else if (section === 'social') {
                loadSocialSettings();
            } else if (section === 'orderSettings') {
                loadOrderSettingsForm();
            } else if (section === 'settings') {
                loadSettings();
            }
        }

        async function loadDashboardData() {
            try {
                showNotification('جاري تحميل البيانات...', 'info');
                
                const productsSnapshot = await database.ref('products').once('value');
                const products = productsSnapshot.val() || {};
                allProducts = Object.values(products);
                document.getElementById('totalProducts').textContent = allProducts.length;

                const ordersSnapshot = await database.ref('orders').once('value');
                const orders = ordersSnapshot.val() || {};
                allOrders = Object.values(orders);
                document.getElementById('totalOrders').textContent = allOrders.length;

                const totalRevenue = allOrders.reduce((sum, order) => sum + (parseFloat(order.total) || 0), 0);
                document.getElementById('totalRevenue').textContent = totalRevenue.toFixed(2) + ' €';

                const customersSnapshot = await database.ref('customers').once('value');
                const customers = customersSnapshot.val() || {};
                allCustomers = Object.values(customers);
                document.getElementById('totalCustomers').textContent = allCustomers.length;

                // حساب الإشعارات (الطلبات الجديدة)
                const pendingOrders = allOrders.filter(order => order.status === 'pending').length;
                document.getElementById('notificationCount').textContent = pendingOrders;

                updateRecentOrders();
                
                showNotification('تم تحميل البيانات بنجاح');
            } catch (error) {
                console.error('Erreur lors du chargement des données:', error);
                showNotification('Erreur lors du chargement des données', 'error');
                
                document.getElementById('totalProducts').textContent = '0';
                document.getElementById('totalOrders').textContent = '0';
                document.getElementById('totalRevenue').textContent = '0 €';
                document.getElementById('totalCustomers').textContent = '0';
                document.getElementById('notificationCount').textContent = '0';
            }
        }

        function updateRecentOrders() {
            const table = document.getElementById('recentOrdersTable');
            const tbody = table.querySelector('tbody');
            
            if (!tbody) return;
            
            if (allOrders.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px;">
                            لا توجد طلبات بعد
                        </td>
                    </tr>
                `;
                return;
            }
            
            const recentOrders = [...allOrders]
                .sort((a, b) => new Date(b.date || 0) - new Date(a.date || 0))
                .slice(0, 5);

            tbody.innerHTML = recentOrders.map(order => `
                <tr>
                    <td>#${order.id || 'N/A'}</td>
                    <td>${order.customer?.firstName || 'N/A'} ${order.customer?.lastName || ''}</td>
                    <td>${order.date ? new Date(order.date).toLocaleDateString('fr-FR') : 'N/A'}</td>
                    <td>${parseFloat(order.total || 0).toFixed(2)} €</td>
                    <td><span class="status-badge status-${order.status || 'pending'}">${getStatusText(order.status)}</span></td>
                    <td>
                        <button class="action-btn view" onclick="viewOrderDetails('${order.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        async function loadProducts() {
            try {
                const productsSnapshot = await database.ref('products').once('value');
                const products = productsSnapshot.val() || {};
                allProducts = Object.values(products);

                const table = document.getElementById('productsTable');
                const tbody = table.querySelector('tbody');
                
                if (!tbody) return;
                
                if (allProducts.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 20px;">
                                لا توجد منتجات بعد. إضغط على "نوڤو برودوي" لإضافة منتج جديد.
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = allProducts.map(product => `
                    <tr>
                        <td>
                            <img src="${product.images && product.images[0] ? product.images[0] : 'https://via.placeholder.com/50'}" 
                                 alt="${product.name}" 
                                 style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px;">
                        </td>
                        <td>${product.name || 'بدون اسم'}</td>
                        <td>${product.category || 'Non catégorisé'}</td>
                        <td>${parseFloat(product.price || 0).toFixed(2)} €</td>
                        <td>${product.stock || 0}</td>
                        <td>
                            <span class="status-badge status-${product.status || 'available'}">
                                ${product.status === 'available' ? 'Disponible' : 
                                  product.status === 'low' ? 'Stock limité' : 'Rupture'}
                            </span>
                        </td>
                        <td>
                            <button class="action-btn edit" onclick="editProduct('${product.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteProduct('${product.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Erreur lors du chargement des produits:', error);
                showNotification('Erreur lors du chargement des produits', 'error');
            }
        }

        function openProductModal(productId = null) {
            const modal = document.getElementById('productModal');
            const title = document.getElementById('modalTitle');
            const form = document.getElementById('productForm');
            
            if (productId) {
                title.textContent = 'Modifier le produit';
                const product = allProducts.find(p => p.id === productId);
                if (product) {
                    document.getElementById('productId').value = productId;
                    document.getElementById('productName').value = product.name || '';
                    document.getElementById('productCategory').value = product.category || '';
                    document.getElementById('productBrand').value = product.brand || '';
                    document.getElementById('productPrice').value = product.price || '';
                    document.getElementById('productOldPrice').value = product.oldPrice || '';
                    document.getElementById('productStock').value = product.stock || '';
                    document.getElementById('productStatus').value = product.status || 'available';
                    document.getElementById('productDescription').value = product.description || '';
                    document.getElementById('productFeatures').value = Array.isArray(product.features) 
                        ? product.features.join('\n') 
                        : '';
                    document.getElementById('productImages').value = Array.isArray(product.images)
                        ? product.images.join('\n')
                        : '';
                }
            } else {
                title.textContent = 'Nouveau produit';
                form.reset();
                document.getElementById('productId').value = '';
                document.getElementById('productStatus').value = 'available';
            }
            
            modal.classList.add('active');
        }

        function closeProductModal() {
            document.getElementById('productModal').classList.remove('active');
        }

        async function saveProduct() {
            try {
                const productId = document.getElementById('productId').value || generateId();
                
                const productName = document.getElementById('productName').value;
                const productPrice = document.getElementById('productPrice').value;
                const productStock = document.getElementById('productStock').value;
                
                if (!productName || !productPrice || !productStock) {
                    showNotification('يرجى ملء جميع الحقول المطلوبة', 'error');
                    return;
                }
                
                const productData = {
                    id: productId,
                    name: productName,
                    category: document.getElementById('productCategory').value,
                    brand: document.getElementById('productBrand').value,
                    price: parseFloat(productPrice),
                    oldPrice: document.getElementById('productOldPrice').value ? parseFloat(document.getElementById('productOldPrice').value) : null,
                    stock: parseInt(productStock),
                    status: document.getElementById('productStatus').value,
                    description: document.getElementById('productDescription').value,
                    features: document.getElementById('productFeatures').value.split('\n').filter(f => f.trim()),
                    images: document.getElementById('productImages').value.split('\n').filter(url => url.trim()),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                await database.ref('products/' + productId).set(productData);
                
                showNotification('تم حفظ المنتج بنجاح');
                closeProductModal();
                loadProducts();
                loadDashboardData();
            } catch (error) {
                console.error('Erreur lors de la sauvegarde du produit:', error);
                showNotification('Erreur lors de la sauvegarde du produit', 'error');
            }
        }

        function editProduct(productId) {
            openProductModal(productId);
        }

        async function deleteProduct(productId) {
            if (confirm('Êtes-vous sûr de vouloir supprimer ce produit ?')) {
                try {
                    await database.ref('products/' + productId).remove();
                    showNotification('تم حذف المنتج بنجاح');
                    loadProducts();
                    loadDashboardData();
                } catch (error) {
                    console.error('Erreur lors de la suppression du produit:', error);
                    showNotification('Erreur lors de la suppression du produit', 'error');
                }
            }
        }

        async function loadOrders() {
            try {
                const ordersSnapshot = await database.ref('orders').once('value');
                const orders = ordersSnapshot.val() || {};
                allOrders = Object.values(orders);

                const table = document.getElementById('ordersTable');
                const tbody = table.querySelector('tbody');
                
                if (!tbody) return;
                
                if (allOrders.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 20px;">
                                لا توجد طلبات بعد
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                // Tri par date (les plus récentes d'abord)
                const sortedOrders = [...allOrders].sort((a, b) => new Date(b.date || 0) - new Date(a.date || 0));
                
                tbody.innerHTML = sortedOrders.map(order => `
                    <tr>
                        <td>#${order.id || 'N/A'}</td>
                        <td>${order.customer?.firstName || 'N/A'} ${order.customer?.lastName || ''}<br><small>${order.customer?.email || ''}</small></td>
                        <td>${order.date ? new Date(order.date).toLocaleDateString('fr-FR') : 'N/A'}</td>
                        <td>${order.items?.length || 0} produits</td>
                        <td>${parseFloat(order.total || 0).toFixed(2)} €</td>
                        <td><span class="status-badge status-${order.status || 'pending'}">${getStatusText(order.status)}</span></td>
                        <td>
                            <button class="action-btn view" onclick="viewOrderDetails('${order.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn confirm" onclick="openOrderStatusModal('${order.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Erreur lors du chargement des commandes:', error);
                showNotification('Erreur lors du chargement des commandes', 'error');
            }
        }

        async function viewOrderDetails(orderId) {
            const order = allOrders.find(o => o.id === orderId);
            if (!order) {
                showNotification('الطلب غير موجود', 'error');
                return;
            }

            // إخفاء جميع الأقسام وإظهار صفحة التفاصيل
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.style.display = 'none';
            });
            
            document.getElementById('orderDetailsPage').classList.add('active');
            document.getElementById('pageTitle').textContent = `Commande #${order.id}`;

            // تحميل تفاصيل الطلب
            const orderDetailsPage = document.getElementById('orderDetailsPage');
            
            const itemsHtml = order.items && order.items.length > 0 ? order.items.map(item => `
                <div class="order-item">
                    <div class="order-item-img">
                        <img src="${item.image || 'https://via.placeholder.com/80'}" alt="${item.name}">
                    </div>
                    <div class="order-item-details">
                        <h4>${item.name}</h4>
                        <div class="order-item-price">
                            ${item.price.toFixed(2)} € x ${item.quantity} = ${(item.price * item.quantity).toFixed(2)} €
                        </div>
                    </div>
                </div>
            `).join('') : '<p>Aucun produit dans cette commande</p>';

            const subtotal = order.subtotal || order.items?.reduce((sum, item) => sum + (item.price * item.quantity), 0) || 0;
            const shipping = order.shipping || 15;
            const total = order.total || subtotal + shipping;

            orderDetailsPage.innerHTML = `
                <div class="back-to-orders" onclick="showSection('orders')">
                    <i class="fas fa-arrow-left"></i>
                    Retour aux commandes
                </div>

                <div class="order-info-grid">
                    <div class="order-info-card">
                        <h3><i class="fas fa-user"></i> Informations client</h3>
                        <div class="order-info-item">
                            <span class="order-info-label">Nom:</span>
                            <span class="order-info-value">${order.customer?.firstName || ''} ${order.customer?.lastName || ''}</span>
                        </div>
                        <div class="order-info-item">
                            <span class="order-info-label">Email:</span>
                            <span class="order-info-value">${order.customer?.email || ''}</span>
                        </div>
                        <div class="order-info-item">
                            <span class="order-info-label">Téléphone:</span>
                            <span class="order-info-value">${order.customer?.phone || ''}</span>
                        </div>
                    </div>

                    <div class="order-info-card">
                        <h3><i class="fas fa-map-marker-alt"></i> Adresse de livraison</h3>
                        <div class="order-info-item">
                            <span class="order-info-label">Adresse:</span>
                            <span class="order-info-value">${order.customer?.address || ''}</span>
                        </div>
                        <div class="order-info-item">
                            <span class="order-info-label">Ville:</span>
                            <span class="order-info-value">${order.customer?.city || ''}</span>
                        </div>
                        <div class="order-info-item">
                            <span class="order-info-label">Code postal:</span>
                            <span class="order-info-value">${order.customer?.postalCode || ''}</span>
                        </div>
                    </div>

                    <div class="order-info-card">
                        <h3><i class="fas fa-info-circle"></i> Informations commande</h3>
                        <div class="order-info-item">
                            <span class="order-info-label">N° Commande:</span>
                            <span class="order-info-value">#${order.id}</span>
                        </div>
                        <div class="order-info-item">
                            <span class="order-info-label">Date:</span>
                            <span class="order-info-value">${order.date ? new Date(order.date).toLocaleString('fr-FR') : 'N/A'}</span>
                        </div>
                        <div class="order-info-item">
                            <span class="order-info-label">Statut:</span>
                            <span class="order-info-value"><span class="status-badge status-${order.status || 'pending'}">${getStatusText(order.status)}</span></span>
                        </div>
                        <div class="order-info-item">
                            <span class="order-info-label">Méthode:</span>
                            <span class="order-info-value">${order.method || 'N/A'}</span>
                        </div>
                    </div>
                </div>

                <div class="order-items">
                    <h3><i class="fas fa-box"></i> Produits commandés</h3>
                    ${itemsHtml}
                </div>

                <div class="order-totals">
                    <h3><i class="fas fa-receipt"></i> Total de la commande</h3>
                    <div class="total-row">
                        <span>Sous-total:</span>
                        <span>${subtotal.toFixed(2)} €</span>
                    </div>
                    <div class="total-row">
                        <span>Frais de livraison:</span>
                        <span>${shipping.toFixed(2)} €</span>
                    </div>
                    <div class="total-row">
                        <span>Total:</span>
                        <span>${total.toFixed(2)} €</span>
                    </div>
                </div>

                <div class="order-actions-container">
                    <button class="btn btn-success" onclick="confirmOrder('${order.id}')">
                        <i class="fas fa-check"></i> Confirmer la commande
                    </button>
                    <button class="btn btn-warning" onclick="openOrderStatusModal('${order.id}')">
                        <i class="fas fa-edit"></i> Changer le statut
                    </button>
                    <button class="btn btn-danger" onclick="cancelOrder('${order.id}')">
                        <i class="fas fa-times"></i> Annuler la commande
                    </button>
                </div>
            `;
        }

        async function confirmOrder(orderId) {
            if (confirm('Êtes-vous sûr de vouloir confirmer cette commande ?')) {
                try {
                    await database.ref('orders/' + orderId + '/status').set('processing');
                    showNotification('Commande confirmée avec succès');
                    // Recharger les données
                    loadDashboardData();
                    loadOrders();
                    // Retourner à la liste des commandes
                    showSection('orders');
                } catch (error) {
                    console.error('Erreur lors de la confirmation de la commande:', error);
                    showNotification('Erreur lors de la confirmation de la commande', 'error');
                }
            }
        }

        async function cancelOrder(orderId) {
            if (confirm('Êtes-vous sûr de vouloir annuler cette commande ?')) {
                try {
                    await database.ref('orders/' + orderId + '/status').set('cancelled');
                    showNotification('Commande annulée avec succès');
                    // Recharger les données
                    loadDashboardData();
                    loadOrders();
                    // Retourner à la liste des commandes
                    showSection('orders');
                } catch (error) {
                    console.error('Erreur lors de l\'annulation de la commande:', error);
                    showNotification('Erreur lors de l\'annulation de la commande', 'error');
                }
            }
        }

        function openOrderStatusModal(orderId) {
            currentOrderId = orderId;
            const order = allOrders.find(o => o.id === orderId);
            if (order) {
                document.getElementById('orderStatusSelect').value = order.status || 'pending';
            }
            document.getElementById('orderStatusModal').classList.add('active');
        }

        function closeOrderStatusModal() {
            document.getElementById('orderStatusModal').classList.remove('active');
            currentOrderId = null;
        }

        async function saveOrderStatus() {
            if (!currentOrderId) return;

            const newStatus = document.getElementById('orderStatusSelect').value;
            const notes = document.getElementById('orderStatusNotes').value;

            try {
                await database.ref('orders/' + currentOrderId + '/status').set(newStatus);
                
                // Sauvegarder les notes si elles existent
                if (notes.trim()) {
                    await database.ref('orders/' + currentOrderId + '/adminNotes').set(notes);
                }
                
                showNotification('Statut de la commande mis à jour');
                closeOrderStatusModal();
                
                // Recharger les données
                loadDashboardData();
                loadOrders();
                
                // Si on est dans la page des détails, recharger les détails
                if (document.getElementById('orderDetailsPage').classList.contains('active')) {
                    viewOrderDetails(currentOrderId);
                }
            } catch (error) {
                console.error('Erreur lors de la mise à jour du statut:', error);
                showNotification('Erreur lors de la mise à jour du statut', 'error');
            }
        }

        async function loadCustomers() {
            try {
                const customersSnapshot = await database.ref('customers').once('value');
                const customers = customersSnapshot.val() || {};
                allCustomers = Object.values(customers);

                const section = document.getElementById('customersSection');
                if (!section) return;
                
                if (allCustomers.length === 0) {
                    section.innerHTML = `
                        <div class="section-header">
                            <div class="section-title">
                                <i class="fas fa-users"></i>
                                <h2>Gestion des clients</h2>
                            </div>
                        </div>
                        <div style="text-align: center; padding: 40px;">
                            <i class="fas fa-users" style="font-size: 50px; color: #ccc; margin-bottom: 20px;"></i>
                            <h3>لا يوجد عملاء بعد</h3>
                            <p>سيظهر العملاء هنا عند إنشاء طلبات جديدة</p>
                        </div>
                    `;
                    return;
                }
                
                section.innerHTML = `
                    <div class="section-header">
                        <div class="section-title">
                            <i class="fas fa-users"></i>
                            <h2>Gestion des clients</h2>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nom</th>
                                    <th>Email</th>
                                    <th>Téléphone</th>
                                    <th>Commandes</th>
                                    <th>Dernière commande</th>
                                    <th>Total dépensé</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${allCustomers.map(customer => `
                                    <tr>
                                        <td>${customer.name || 'N/A'}</td>
                                        <td>${customer.email || 'N/A'}</td>
                                        <td>${customer.phone || 'N/A'}</td>
                                        <td>${customer.orders?.length || 0}</td>
                                        <td>${customer.lastOrder ? new Date(customer.lastOrder).toLocaleDateString('fr-FR') : 'Jamais'}</td>
                                        <td>${(customer.totalSpent || 0).toFixed(2)} €</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } catch (error) {
                console.error('Erreur lors du chargement des clients:', error);
                showNotification('Erreur lors du chargement des clients', 'error');
            }
        }

        async function loadContent() {
            try {
                const contentSnapshot = await database.ref('siteContent').once('value');
                const content = contentSnapshot.val() || {};

                document.getElementById('siteName').value = content.siteName || 'متجري الإلكتروني';
                document.getElementById('siteLogo').value = content.siteLogo || '';
                document.getElementById('heroImage').value = content.heroImage || '';
                document.getElementById('mainTitle').value = content.mainTitle || 'مرحبا بكم في متجرنا';
                document.getElementById('subTitle').value = content.subTitle || 'أفضل المنتجات بأفضل الأسعار';
                document.getElementById('siteDescription').value = content.siteDescription || '';
                document.getElementById('productsTitle').value = content.productsTitle || 'منتجاتنا';
                document.getElementById('productsDescription').value = content.productsDescription || '';
                document.getElementById('servicesTitle').value = content.servicesTitle || 'خدماتنا';
                document.getElementById('servicesList').value = Array.isArray(content.services) 
                    ? content.services.join('\n') 
                    : '';
                document.getElementById('defaultImages').value = Array.isArray(content.defaultImages)
                    ? content.defaultImages.join('\n')
                    : '';

                if (content.siteLogo) {
                    document.getElementById('storeLogo').style.backgroundImage = `url(${content.siteLogo})`;
                    document.getElementById('storeLogo').style.backgroundSize = 'contain';
                    document.getElementById('storeLogo').style.backgroundRepeat = 'no-repeat';
                    document.getElementById('storeLogo').style.backgroundPosition = 'center';
                }
            } catch (error) {
                console.error('Erreur lors du chargement du contenu:', error);
                showNotification('Erreur lors du chargement du contenu', 'error');
            }
        }

        async function saveContent(e) {
            e.preventDefault();
            try {
                const contentData = {
                    siteName: document.getElementById('siteName').value,
                    siteLogo: document.getElementById('siteLogo').value,
                    heroImage: document.getElementById('heroImage').value,
                    mainTitle: document.getElementById('mainTitle').value,
                    subTitle: document.getElementById('subTitle').value,
                    siteDescription: document.getElementById('siteDescription').value,
                    productsTitle: document.getElementById('productsTitle').value,
                    productsDescription: document.getElementById('productsDescription').value,
                    servicesTitle: document.getElementById('servicesTitle').value,
                    services: document.getElementById('servicesList').value.split('\n').filter(s => s.trim()),
                    defaultImages: document.getElementById('defaultImages').value.split('\n').filter(url => url.trim()),
                    updatedAt: new Date().toISOString()
                };

                await database.ref('siteContent').set(contentData);
                
                if (contentData.siteLogo) {
                    document.getElementById('storeLogo').style.backgroundImage = `url(${contentData.siteLogo})`;
                    document.getElementById('storeLogo').style.backgroundSize = 'contain';
                    document.getElementById('storeLogo').style.backgroundRepeat = 'no-repeat';
                    document.getElementById('storeLogo').style.backgroundPosition = 'center';
                }
                
                showNotification('تم حفظ المحتوى بنجاح');
            } catch (error) {
                console.error('Erreur lors de la sauvegarde du contenu:', error);
                showNotification('Erreur lors de la sauvegarde du contenu', 'error');
            }
        }

        async function loadSocialSettings() {
            try {
                const socialSnapshot = await database.ref('socialSettings').once('value');
                const social = socialSnapshot.val() || {};

                document.getElementById('whatsappUrl').value = social.whatsappUrl || '';
                document.getElementById('messengerUrl').value = social.messengerUrl || '';
                document.getElementById('facebookUrl').value = social.facebookUrl || '';
                document.getElementById('instagramUrl').value = social.instagramUrl || '';
                document.getElementById('socialPosition').value = social.position || 'bottom-right';
            } catch (error) {
                console.error('Erreur lors du chargement des paramètres sociaux:', error);
                showNotification('Erreur lors du chargement des paramètres sociaux', 'error');
            }
        }

        async function saveSocialSettings(e) {
            e.preventDefault();
            try {
                const socialData = {
                    whatsappUrl: document.getElementById('whatsappUrl').value,
                    messengerUrl: document.getElementById('messengerUrl').value,
                    facebookUrl: document.getElementById('facebookUrl').value,
                    instagramUrl: document.getElementById('instagramUrl').value,
                    position: document.getElementById('socialPosition').value,
                    updatedAt: new Date().toISOString()
                };

                await database.ref('socialSettings').set(socialData);
                showNotification('تم حفظ إعدادات التواصل الاجتماعي');
            } catch (error) {
                console.error('Erreur lors de la sauvegarde des paramètres sociaux:', error);
                showNotification('Erreur lors de la sauvegarde des paramètres sociaux', 'error');
            }
        }

        async function loadOrderSettings() {
            try {
                const orderSnapshot = await database.ref('orderSettings').once('value');
                orderSettingsData = orderSnapshot.val() || {};
            } catch (error) {
                console.error('Erreur lors du chargement des paramètres de commande:', error);
                orderSettingsData = {};
            }
        }

        async function loadOrderSettingsForm() {
            try {
                document.getElementById('whatsappEnabled').checked = orderSettingsData.whatsappEnabled !== false;
                document.getElementById('messengerEnabled').checked = orderSettingsData.messengerEnabled !== false;
                document.getElementById('directOrderEnabled').checked = orderSettingsData.directOrderEnabled !== false;
                document.getElementById('whatsappNumber').value = orderSettingsData.whatsappNumber || '';
                document.getElementById('messengerLink').value = orderSettingsData.messengerLink || '';
                document.getElementById('defaultOrderMessage').value = orderSettingsData.defaultOrderMessage || '';
            } catch (error) {
                console.error('Erreur lors du chargement des paramètres de commande:', error);
            }
        }

        async function saveOrderSettings(e) {
            e.preventDefault();
            try {
                const orderSettings = {
                    whatsappEnabled: document.getElementById('whatsappEnabled').checked,
                    messengerEnabled: document.getElementById('messengerEnabled').checked,
                    directOrderEnabled: document.getElementById('directOrderEnabled').checked,
                    whatsappNumber: document.getElementById('whatsappNumber').value,
                    messengerLink: document.getElementById('messengerLink').value,
                    defaultOrderMessage: document.getElementById('defaultOrderMessage').value,
                    updatedAt: new Date().toISOString()
                };

                await database.ref('orderSettings').set(orderSettings);
                orderSettingsData = orderSettings;
                showNotification('تم حفظ إعدادات الطلبات بنجاح');
            } catch (error) {
                console.error('Erreur lors de la sauvegarde des paramètres de commande:', error);
                showNotification('Erreur lors de la sauvegarde des paramètres de commande', 'error');
            }
        }

        async function loadSettings() {
            try {
                const settingsSnapshot = await database.ref('settings').once('value');
                const settings = settingsSnapshot.val() || {};

                document.getElementById('currency').value = settings.currency || '€';
                document.getElementById('language').value = settings.language || 'fr';
                document.getElementById('shippingCost').value = settings.shippingCost || 15;
                document.getElementById('taxRate').value = settings.taxRate || 20;
            } catch (error) {
                console.error('Erreur lors du chargement des paramètres:', error);
                showNotification('Erreur lors du chargement des paramètres', 'error');
            }
        }

        async function saveGeneralSettings(e) {
            e.preventDefault();
            try {
                const settingsData = {
                    currency: document.getElementById('currency').value,
                    language: document.getElementById('language').value,
                    shippingCost: parseFloat(document.getElementById('shippingCost').value),
                    taxRate: parseFloat(document.getElementById('taxRate').value),
                    updatedAt: new Date().toISOString()
                };

                await database.ref('settings').set(settingsData);
                showNotification('تم حفظ الإعدادات بنجاح');
            } catch (error) {
                console.error('Erreur lors de la sauvegarde des paramètres:', error);
                showNotification('Erreur lors de la sauvegarde des paramètres', 'error');
            }
        }

        async function loadStoreSettings() {
            try {
                const settingsSnapshot = await database.ref('storeSettings').once('value');
                storeSettings = settingsSnapshot.val() || {};
            } catch (error) {
                console.error('Erreur lors du chargement des paramètres du magasin:', error);
            }
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            
            // إزالة جميع الأنواع وإضافة النوع الجديد
            notification.className = 'notification';
            if (type === 'error') {
                notification.classList.add('error');
            } else if (type === 'warning') {
                notification.classList.add('warning');
            } else if (type === 'info') {
                // لا تضيف أي class إضافي للـ info
            } else {
                notification.classList.add('success');
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function getStatusText(status) {
            const statusMap = {
                'pending': 'En attente',
                'processing': 'En traitement',
                'shipped': 'Expédiée',
                'delivered': 'Livrée',
                'cancelled': 'Annulée',
                'available': 'متوفر',
                'low': 'كمية محدودة',
                'out': 'نفذ من المخزون'
            };
            return statusMap[status] || status || 'غير معروف';
        }
    </script>
</body>
</html>